<!DOCTYPE html>
<html lang="en">
  <!-- Head -->
  <head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
    <!-- Metadata, OpenGraph and Schema.org -->




<!-- Standard metadata -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>
  
  
    
      Publishing SmartThings events to an Azure Event Hub | Ben Crouse
    
  
</title>
<meta name="author" content="Ben Crouse">
<meta name="description" content="In this post I will walk through setting up and Event Hub in Azure and publishing events to it using a Smart App that I will write
">

  <meta name="keywords" content="software-development, programming, web-development, developer-blog, technology">










<!-- Bootstrap & MDB -->
<link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous">



<!-- Fonts & Icons -->
<link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5">
<link defer rel="stylesheet" href="/assets/css/scholar-icons.css?62b2ac103a88034e6882a5be5f3e2772">
<link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap">

<!-- Code Syntax Highlighting -->
<link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light">



<!-- Styles -->




  <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%F0%9F%92%BB&lt;/text&gt;&lt;/svg&gt;">

<link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e">
<link rel="canonical" href="https://bencrouse.com/blog/2015/publishing-smartthings-events-to-an-azure-event-hub/">


  <!-- Dark Mode -->
  <script src="/assets/js/theme.js?61a71b4bf8cc88f490e9b04fb200867e"></script>
  <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark">
  <script>
    initTheme();
  </script>










  </head>

  <!-- Body -->
  <body class="fixed-top-nav ">
    <!-- Header -->
    <header>
  <!-- Nav Bar -->
  <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation">
    <div class="container">
      
        <a class="navbar-brand title font-weight-lighter" href="/">
          
            
              <span class="font-weight-bold">Ben</span>
            
            
            Crouse
          
        </a>
      
      <!-- Navbar Toggle -->
      <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar top-bar"></span>
        <span class="icon-bar middle-bar"></span>
        <span class="icon-bar bottom-bar"></span>
      </button>

      <div class="collapse navbar-collapse text-right" id="navbarNav">
        <ul class="navbar-nav ml-auto flex-nowrap">
          

          <!-- About -->
          <li class="nav-item ">
            <a class="nav-link" href="/">about
              
            </a>
          </li>

          <!-- Other pages -->
          
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
              
                
                <li class="nav-item active">
                  <a class="nav-link" href="/blog/">blog
                    
                  </a>
                </li>
              
            
          
            
              
                
                <li class="nav-item ">
                  <a class="nav-link" href="/cv/">cv
                    
                  </a>
                </li>
              
            
          
          
            <!-- Search -->
            <li class="nav-item">
              <button id="search-toggle" title="Search" onclick="openSearchModal()">
                <span class="nav-link">ctrl k <i class="ti ti-search"></i></span>
              </button>
            </li>
          
          
            <!-- Toogle theme mode -->
            <li class="toggle-container">
              <button id="light-toggle" title="Change theme">
                <i class="ti ti-sun-moon" id="light-toggle-system"></i>
                <i class="ti ti-moon-filled" id="light-toggle-dark"></i>
                <i class="ti ti-sun-filled" id="light-toggle-light"></i>
              </button>
            </li>
          
        </ul>
      </div>
    </div>
  </nav>
  
    <!-- Scrolling Progress Bar -->
    <progress id="progress" value="0">
      <div class="progress-container">
        <span class="progress-bar"></span>
      </div>
    </progress>
  
</header>


    <!-- Content -->
    <div class="container mt-5" role="main">
      
        






<div class="post">
  <header class="post-header">
    <h1 class="post-title">Publishing SmartThings events to an Azure Event Hub</h1>
    <p class="post-meta">
      Created on September 03, 2015
      
      
      
    </p>
    <p class="post-tags">
      
        <a href="/blog/2015"> <i class="fa-solid fa-calendar fa-sm"></i> 2015 </a>
      
      

      
    </p>
  </header>

  <article class="post-content">
    
    <div id="markdown-content">
      <p>I wanted to be able to publish events from my SmartThings devices to Azure Event Hub. Once I am publishing the events to Event Hub I will be able to save the data or take actions in real time based on the incoming data. In this post I will walk through setting up and Event Hub in Azure and publishing events to it using a Smart App that I will write.</p>

<h2 id="creating-an-azure-event-hub">Creating an Azure Event Hub</h2>

<p>To set up your Event Hub in Azure go to the <a href="https://portal.azure.com" rel="external nofollow noopener" target="_blank">Azure Management Portal</a> and click the new button at the bottom. Then click on App Services, Service Bus, Event Hub, Quick Create.</p>

<p><img src="/post_images/2015/09/create_event_hub.png" alt="Create Event Hub"></p>

<p>This will create an Event Hub under the Service Bus Section in the Portal. You will need the URL to connect to the Event Hub and you will need to set up access rules. You will also need to create an SAS token to access the Event Hub from the SmartThings App. See my previous post for details on how to do this.</p>

<h2 id="creating-a-smartthings-app">Creating a SmartThings App</h2>

<p>Log in to the <a href="https://graph.api.smartthings.com/ide/apps" rel="external nofollow noopener" target="_blank">SmartThings Developer</a> site and click the green New SmartApp button.</p>

<p>Fill in the required fields. In the Settings section create EventHubSecret and EventHubURL settings. Put your SAS token and your Event Hub URL in these.</p>

<p><img src="/post_images/2015/09/smartthings_event_hub_settings.png" alt="SmartThings Event Hub Settings"></p>

<p>Click Create and you will be taken to the web IDE for the SmartApp.</p>

<h2 id="register-for-events-from-your-devices">Register for events from your devices</h2>

<p>The first section of the app is the definition. These settings are populated by what you entered while creating the app.</p>

<p>The next section is the preferences section. This is where you tell SmartThings which sensors you wish to use in your app and you can specify names for them. I have several sensors I will use so I have set it up for power, light, motion, etc. You can also group related sensors by using a Section.</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">preferences</span> <span class="p">{</span>
    <span class="nf">section</span><span class="p">(</span><span class="dl">"</span><span class="s2">Power Meter</span><span class="dl">"</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">input</span> <span class="dl">"</span><span class="s2">powers</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">capability.powerMeter</span><span class="dl">"</span><span class="p">,</span> <span class="nx">title</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Power Sensor</span><span class="dl">"</span><span class="p">,</span> <span class="nx">multiple</span><span class="p">:</span> <span class="kc">true</span>
    <span class="p">}</span>
    <span class="nf">section</span><span class="p">(</span><span class="dl">"</span><span class="s2">Environment</span><span class="dl">"</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">input</span> <span class="dl">"</span><span class="s2">temperatures</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">capability.temperatureMeasurement</span><span class="dl">"</span><span class="p">,</span> <span class="nx">title</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Temperature Sensors</span><span class="dl">"</span><span class="p">,</span> <span class="nx">multiple</span><span class="p">:</span> <span class="kc">true</span>
        <span class="nx">input</span> <span class="dl">"</span><span class="s2">lightMeters</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">capability.illuminanceMeasurement</span><span class="dl">"</span><span class="p">,</span> <span class="nx">title</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Light Sensors</span><span class="dl">"</span><span class="p">,</span> <span class="nx">multiple</span><span class="p">:</span> <span class="kc">true</span>
        <span class="nx">input</span> <span class="dl">"</span><span class="s2">humidityMeters</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">capability.relativeHumidityMeasurement</span><span class="dl">"</span><span class="p">,</span> <span class="nx">title</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Humidity Sensors</span><span class="dl">"</span><span class="p">,</span> <span class="nx">multiple</span><span class="p">:</span> <span class="kc">true</span>
    <span class="p">}</span>
    <span class="nf">section</span><span class="p">(</span><span class="dl">"</span><span class="s2">Security Sensors</span><span class="dl">"</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">input</span> <span class="dl">"</span><span class="s2">motions</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">capability.motionSensor</span><span class="dl">"</span><span class="p">,</span> <span class="nx">title</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Motion Sensors</span><span class="dl">"</span><span class="p">,</span> <span class="nx">multiple</span><span class="p">:</span> <span class="kc">true</span>
        <span class="nx">input</span> <span class="dl">"</span><span class="s2">contacts</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">capability.contactSensor</span><span class="dl">"</span><span class="p">,</span> <span class="nx">title</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Contact Sensors</span><span class="dl">"</span><span class="p">,</span> <span class="nx">multiple</span><span class="p">:</span> <span class="kc">true</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>In the initialize section you can subscribe to events from your devices.</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">def</span> <span class="nf">initialize</span><span class="p">()</span> <span class="p">{</span>
    <span class="nf">subscribe</span><span class="p">(</span><span class="nx">powers</span><span class="p">,</span> <span class="dl">"</span><span class="s2">power</span><span class="dl">"</span><span class="p">,</span> <span class="nx">powerHandler</span><span class="p">)</span>
    <span class="nf">subscribe</span><span class="p">(</span><span class="nx">temperatures</span><span class="p">,</span> <span class="dl">"</span><span class="s2">temperature</span><span class="dl">"</span><span class="p">,</span> <span class="nx">temperatureHandler</span><span class="p">)</span>
    <span class="nf">subscribe</span><span class="p">(</span><span class="nx">motions</span><span class="p">,</span> <span class="dl">"</span><span class="s2">motion</span><span class="dl">"</span><span class="p">,</span> <span class="nx">motionHandler</span><span class="p">)</span>
    <span class="nf">subscribe</span><span class="p">(</span><span class="nx">contacts</span><span class="p">,</span> <span class="dl">"</span><span class="s2">contact</span><span class="dl">"</span><span class="p">,</span> <span class="nx">contactHandler</span><span class="p">)</span>
    <span class="nf">subscribe</span><span class="p">(</span><span class="nx">lightMeters</span><span class="p">,</span> <span class="dl">"</span><span class="s2">illuminance</span><span class="dl">"</span><span class="p">,</span> <span class="nx">illuminanceHandler</span><span class="p">)</span>
    <span class="nf">subscribe</span><span class="p">(</span><span class="nx">humidityMeters</span><span class="p">,</span> <span class="dl">"</span><span class="s2">humidity</span><span class="dl">"</span><span class="p">,</span> <span class="nx">humidityHandler</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="sending-events-to-the-event-hub">Sending events to the Event Hub</h2>

<p>The next thing that we need to do is to create the method that will send data to the Event Hub. Data will be sent to the Event Hub with a POST to the Event Hub URL. SmartThings does this with the httpPost method. This method takes an object that contains the parameters for the post.</p>

<p>The url is the Event Hub URL. The body will be a json object containing the data about the event. You can send any data you want in the body. I am sending the sensor ID, name, type, and the value of the sensor. The content type and the request content type must be defined because the Event Hub returns a different content type than the body content type. Finally, the Authorization header must be set using the SAS token that was created for the Event Hub.</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">def</span> <span class="nf">sendEvent</span><span class="p">(</span><span class="nx">sensorId</span><span class="p">,</span> <span class="nx">sensorName</span><span class="p">,</span> <span class="nx">sensorType</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">log</span><span class="p">.</span><span class="nx">debug</span> <span class="dl">"</span><span class="s2">sending ${sensorId} at ${value}</span><span class="dl">"</span>
    <span class="nx">def</span> <span class="nx">cleanedSensorId</span> <span class="o">=</span> <span class="nx">sensorId</span><span class="p">.</span><span class="nf">replace</span><span class="p">(</span><span class="dl">"</span><span class="s2"> </span><span class="dl">"</span><span class="p">,</span> <span class="dl">""</span><span class="p">)</span>
    <span class="nx">def</span> <span class="nx">params</span> <span class="o">=</span> <span class="p">[</span>
        <span class="nx">uri</span><span class="p">:</span> <span class="dl">"</span><span class="s2">${appSettings.EventHubURL}</span><span class="dl">"</span><span class="p">,</span>
        <span class="nx">body</span><span class="p">:</span> <span class="dl">"</span><span class="s2">{ sensorId : </span><span class="se">\"</span><span class="s2">${cleanedSensorId}</span><span class="se">\"</span><span class="s2">, sensorName : </span><span class="se">\"</span><span class="s2">${sensorName}</span><span class="se">\"</span><span class="s2">, sensorType : </span><span class="se">\"</span><span class="s2">${sensorType}</span><span class="se">\"</span><span class="s2">, value : </span><span class="se">\"</span><span class="s2">${value}</span><span class="se">\"</span><span class="s2"> }</span><span class="dl">"</span><span class="p">,</span>
        <span class="nx">contentType</span><span class="p">:</span> <span class="dl">"</span><span class="s2">application/xml; charset=utf-8</span><span class="dl">"</span><span class="p">,</span>
        <span class="nx">requestContentType</span><span class="p">:</span> <span class="dl">"</span><span class="s2">application/atom+xml;type=entry;charset=utf-8</span><span class="dl">"</span><span class="p">,</span>
        <span class="nx">headers</span><span class="p">:</span> <span class="p">[</span><span class="dl">"</span><span class="s2">Authorization</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">${appSettings.EventHubSecret}</span><span class="dl">"</span><span class="p">],</span>
    <span class="p">]</span>
    
    <span class="k">try</span> <span class="p">{</span>
        <span class="nf">httpPost</span><span class="p">(</span><span class="nx">params</span><span class="p">)</span> <span class="p">{</span> <span class="nx">resp</span> <span class="o">-&gt;</span> 
            <span class="nx">log</span><span class="p">.</span><span class="nx">debug</span> <span class="dl">"</span><span class="s2">response message ${resp}</span><span class="dl">"</span>
        <span class="p">}</span>
    <span class="p">}</span> <span class="k">catch </span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">//seems to think 201 is an error</span>
        <span class="c1">//log.error "something went wrong: $e"</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>The Event Hub returns a 201 Created http status code. This causes an exception to be thrown. The error log is commented out for this reason, but while getting the app running it may be beneficial to uncomment it.</p>

<p>The final step is to create the event handlers that will use this method to send data to the event hub. For events that have a numeric value such as the power meter I am just sending the value directly to the event hub.</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">def</span> <span class="nf">powerHandler</span><span class="p">(</span><span class="nx">evt</span><span class="p">)</span> <span class="p">{</span>
    <span class="nf">sendEvent</span><span class="p">(</span><span class="dl">'</span><span class="s1">powerMeter</span><span class="dl">'</span><span class="p">,</span> <span class="nx">evt</span><span class="p">.</span><span class="nx">displayName</span><span class="p">,</span> <span class="dl">'</span><span class="s1">power</span><span class="dl">'</span><span class="p">,</span> <span class="nx">evt</span><span class="p">.</span><span class="nx">value</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<p>For the events that contain a text value I am converting it for easier processing later.</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">def</span> <span class="nf">motionHandler</span><span class="p">(</span><span class="nx">evt</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if </span><span class="p">(</span><span class="nx">evt</span><span class="p">.</span><span class="nx">value</span> <span class="o">==</span> <span class="dl">'</span><span class="s1">active</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
        <span class="nf">sendEvent</span><span class="p">(</span><span class="nx">evt</span><span class="p">.</span><span class="nx">displayName</span> <span class="o">+</span> <span class="dl">'</span><span class="s1">motion</span><span class="dl">'</span><span class="p">,</span> <span class="nx">evt</span><span class="p">.</span><span class="nx">displayName</span><span class="p">,</span> <span class="dl">'</span><span class="s1">motion</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">motion detected</span><span class="dl">'</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="k">if </span><span class="p">(</span><span class="nx">evt</span><span class="p">.</span><span class="nx">value</span> <span class="o">==</span> <span class="dl">'</span><span class="s1">inactive</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
        <span class="nf">sendEvent</span><span class="p">(</span><span class="nx">evt</span><span class="p">.</span><span class="nx">displayName</span> <span class="o">+</span> <span class="dl">'</span><span class="s1">motion</span><span class="dl">'</span><span class="p">,</span> <span class="nx">evt</span><span class="p">.</span><span class="nx">displayName</span><span class="p">,</span> <span class="dl">'</span><span class="s1">motion</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">no motion detected</span><span class="dl">'</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Here is the code for all of my event handlers:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">def</span> <span class="nf">powerHandler</span><span class="p">(</span><span class="nx">evt</span><span class="p">)</span> <span class="p">{</span>
    <span class="nf">sendEvent</span><span class="p">(</span><span class="dl">'</span><span class="s1">powerMeter</span><span class="dl">'</span><span class="p">,</span> <span class="nx">evt</span><span class="p">.</span><span class="nx">displayName</span><span class="p">,</span> <span class="dl">'</span><span class="s1">power</span><span class="dl">'</span><span class="p">,</span> <span class="nx">evt</span><span class="p">.</span><span class="nx">value</span><span class="p">)</span>
<span class="p">}</span>

<span class="nx">def</span> <span class="nf">temperatureHandler</span><span class="p">(</span><span class="nx">evt</span><span class="p">)</span> <span class="p">{</span>    
    <span class="nf">sendEvent</span><span class="p">(</span><span class="nx">evt</span><span class="p">.</span><span class="nx">displayName</span> <span class="o">+</span> <span class="dl">'</span><span class="s1">temp</span><span class="dl">'</span><span class="p">,</span> <span class="nx">evt</span><span class="p">.</span><span class="nx">displayName</span><span class="p">,</span> <span class="dl">'</span><span class="s1">temperature</span><span class="dl">'</span><span class="p">,</span> <span class="nx">evt</span><span class="p">.</span><span class="nx">value</span><span class="p">)</span>
<span class="p">}</span>

<span class="nx">def</span> <span class="nf">motionHandler</span><span class="p">(</span><span class="nx">evt</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if </span><span class="p">(</span><span class="nx">evt</span><span class="p">.</span><span class="nx">value</span> <span class="o">==</span> <span class="dl">'</span><span class="s1">active</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
        <span class="nf">sendEvent</span><span class="p">(</span><span class="nx">evt</span><span class="p">.</span><span class="nx">displayName</span> <span class="o">+</span> <span class="dl">'</span><span class="s1">motion</span><span class="dl">'</span><span class="p">,</span> <span class="nx">evt</span><span class="p">.</span><span class="nx">displayName</span><span class="p">,</span> <span class="dl">'</span><span class="s1">motion</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">motion detected</span><span class="dl">'</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="k">if </span><span class="p">(</span><span class="nx">evt</span><span class="p">.</span><span class="nx">value</span> <span class="o">==</span> <span class="dl">'</span><span class="s1">inactive</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
        <span class="nf">sendEvent</span><span class="p">(</span><span class="nx">evt</span><span class="p">.</span><span class="nx">displayName</span> <span class="o">+</span> <span class="dl">'</span><span class="s1">motion</span><span class="dl">'</span><span class="p">,</span> <span class="nx">evt</span><span class="p">.</span><span class="nx">displayName</span><span class="p">,</span> <span class="dl">'</span><span class="s1">motion</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">no motion detected</span><span class="dl">'</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="nx">def</span> <span class="nf">contactHandler</span><span class="p">(</span><span class="nx">evt</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if </span><span class="p">(</span><span class="nx">evt</span><span class="p">.</span><span class="nx">value</span> <span class="o">==</span> <span class="dl">'</span><span class="s1">open</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
        <span class="nf">sendEvent</span><span class="p">(</span><span class="nx">evt</span><span class="p">.</span><span class="nx">displayName</span> <span class="o">+</span> <span class="dl">'</span><span class="s1">contact</span><span class="dl">'</span><span class="p">,</span> <span class="nx">evt</span><span class="p">.</span><span class="nx">displayName</span><span class="p">,</span> <span class="dl">'</span><span class="s1">doorOpen</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">open</span><span class="dl">'</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="k">if </span><span class="p">(</span><span class="nx">evt</span><span class="p">.</span><span class="nx">value</span> <span class="o">==</span> <span class="dl">'</span><span class="s1">closed</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
        <span class="nf">sendEvent</span><span class="p">(</span><span class="nx">evt</span><span class="p">.</span><span class="nx">displayName</span> <span class="o">+</span> <span class="dl">'</span><span class="s1">contact</span><span class="dl">'</span><span class="p">,</span> <span class="nx">evt</span><span class="p">.</span><span class="nx">displayName</span><span class="p">,</span> <span class="dl">'</span><span class="s1">doorOpen</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">open</span><span class="dl">'</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="nx">def</span> <span class="nf">illuminanceHandler</span><span class="p">(</span><span class="nx">evt</span><span class="p">)</span> <span class="p">{</span>
    <span class="nf">sendEvent</span><span class="p">(</span><span class="nx">evt</span><span class="p">.</span><span class="nx">displayName</span> <span class="o">+</span> <span class="dl">'</span><span class="s1">light</span><span class="dl">'</span><span class="p">,</span> <span class="nx">evt</span><span class="p">.</span><span class="nx">displayName</span><span class="p">,</span> <span class="dl">'</span><span class="s1">lumens</span><span class="dl">'</span><span class="p">,</span> <span class="nx">evt</span><span class="p">.</span><span class="nx">value</span><span class="p">)</span>
<span class="p">}</span>

<span class="nx">def</span> <span class="nf">humidityHandler</span><span class="p">(</span><span class="nx">evt</span><span class="p">)</span> <span class="p">{</span>
    <span class="nf">sendEvent</span><span class="p">(</span><span class="nx">evt</span><span class="p">.</span><span class="nx">displayName</span> <span class="o">+</span> <span class="dl">'</span><span class="s1">humidity</span><span class="dl">'</span><span class="p">,</span> <span class="nx">evt</span><span class="p">.</span><span class="nx">displayName</span><span class="p">,</span> <span class="dl">'</span><span class="s1">humidity</span><span class="dl">'</span><span class="p">,</span> <span class="nx">evt</span><span class="p">.</span><span class="nx">value</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="run-the-app-and-verify-it-is-working">Run the app and verify it is working</h2>
<p>Everything is ready to run now. On the right side of the SmartApp IDE click Set Location and then set your sensors.</p>

<p><img src="/post_images/2015/09/test_sensors.png" alt="Test Sensors"></p>

<p>The headings and labels created in the SmartApp preferences will be shown. Each section will have virtual devices that can be controlled in the IDE for testing. I am just using my physical devices here.</p>

<p>After setting your sensors click on the Install button below the sensor settings. You should now be able to see log statements as events are sent.</p>

<p>Let the app run for at least 30 minutes and then check the Event Hub’s Dashboard in the Azure Management Portal. You should see a graph indicating that events are coming in and everything is working correctly.</p>

<p><img src="/post_images/2015/09/azure_event_hub_messages.png" alt="Azure Event Hub Messages"></p>

    </div>
  </article>

  

  

  
    
      

  
    
    
      <br>
      <hr>
      <br>
      <ul class="list-disc pl-8"></ul>

      <!-- Adds related posts to the end of an article -->
      <h2 class="text-3xl font-semibold mb-4 mt-12">Enjoy Reading This Article?</h2>
    

    <p class="mb-2">Here are some more articles you might like to read next:</p>
  

  <li class="my-2">
    
      <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2016/using-services-in-angularjs-to-share-state/">Using services in AngularJS to share state</a>
    
  </li>

  

  <li class="my-2">
    
      <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2016/creating-a-mock-idbset-using-moq/">Creating a Mock IDbSet using Moq</a>
    
  </li>

  

  <li class="my-2">
    
      <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2015/timing-health-checks-in-a-functional-way/">Timing Health Checks in a Functional Way</a>
    
  </li>

  

  <li class="my-2">
    
      <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2015/creating-an-azure-sas-token-in-f/">Creating an Azure SAS token in F#</a>
    
  </li>



    
  

  
  
</div>

      
    </div>

    <!-- Footer -->
    


  <footer class="fixed-bottom" role="contentinfo">
    <div class="container mt-0">
      
  © Copyright 2025
  Ben
  
  Crouse. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>.

  
  

    </div>
  </footer>



    <!-- JavaScripts -->
    <!-- jQuery -->
<script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>

<!-- Bootsrap & MDB scripts -->
<script src="/assets/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script>


  <!-- Masonry & imagesLoaded -->
  <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script>
  <script defer src="/assets/js/masonry.js?a0db7e5d5c70cc3252b3138b0c91dcaf" type="text/javascript"></script>























  <!-- Medium Zoom JS -->
  <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script>
  <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script>






<!-- Load Common JS -->
<script src="/assets/js/no_defer.js?2781658a0a2b13ed609542042a859126"></script>
<script defer src="/assets/js/common.js?e0514a05c5c95ac1a93a8dfd5249b92e"></script>
<script defer src="/assets/js/copy_code.js?c8a01c11a92744d44b093fc3bda915df" type="text/javascript"></script>

<!-- Jupyter Open External Links New Tab -->
<script defer src="/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script>

<!-- Badges -->

  <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script>


  <script async src="https://badge.dimensions.ai/badge.js"></script>



  <!-- MathJax -->
  <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script>
  
    <script src="/assets/js/mathjax-setup.js?a5bb4e6a542c546dd929b24b8b236dfd"></script>
    <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6" crossorigin="anonymous"></script>
  









  <!-- Scrolling Progress Bar -->
  <script defer src="/assets/js/progress-bar.js?2f30e0e6801ea8f5036fa66e1ab0a71a" type="text/javascript"></script>







  <!-- Back to Top -->
  <script src="/assets/js/vanilla-back-to-top.min.js?f40d453793ff4f64e238e420181a1d17"></script>
  <script>
    addBackToTop();
  </script>



  <!-- Search -->
  <script type="module" src="/assets/js/search/ninja-keys.min.js?a3446f084dcaecc5f75aa1757d087dcf"></script>
  <ninja-keys hidebreadcrumbs noautoloadmdicons placeholder="Type to start searching"></ninja-keys>
  <script src="/assets/js/search-setup.js?6c304f7b1992d4b60f7a07956e52f04a"></script>
  <script src="/assets/js/search-data.js"></script>
  <script src="/assets/js/shortcut-key.js?6f508d74becd347268a7f822bca7309d"></script>




  </body>
</html>
